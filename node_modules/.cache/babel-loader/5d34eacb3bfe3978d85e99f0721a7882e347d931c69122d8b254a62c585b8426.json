{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nimport { useUserStore } from '@/stores/user';\nimport { useCategoriesStore } from '@/stores/categories';\nexport default {\n  name: \"Insert Listing\",\n  data() {\n    return {\n      imageIndex: 0,\n      title: '',\n      description: '',\n      price: 0,\n      phone: '',\n      email: '',\n      imagesUrls: [],\n      category: '',\n      images: [],\n      categoriesStore: Object\n    };\n  },\n  created() {\n    this.categoriesStore = useCategoriesStore();\n  },\n  methods: {\n    nextImage(e) {\n      e.preventDefault();\n      const carouselItems = document.getElementsByClassName(\"carousel-item\");\n      this.imageIndex = (this.imageIndex + 1) % carouselItems.length;\n    },\n    prevImage(e) {\n      e.preventDefault();\n      const carouselItems = document.getElementsByClassName(\"carousel-item\");\n      this.imageIndex = (this.imageIndex - 1) % carouselItems.length;\n      if (this.imageIndex < 0) this.imageIndex = carouselItems.length - 1;\n    },\n    setImages(e) {\n      e.preventDefault();\n      const reader = new FileReader();\n      let images = Array.from(e.target.files);\n      images = images.filter(f => f['type'] === 'image/jpeg' || f['type'] === 'image/png'); //filters file that are not images\n\n      this.imagesUrls = [];\n      if (images) {\n        Array.prototype.forEach.call(images, this.readAndPreview);\n      }\n      this.images = images;\n    },\n    async submit(e) {\n      e.preventDefault();\n      const formData = new FormData();\n      this.images.forEach(img => {\n        formData.append(`files`, img);\n      });\n      const resImages = await axios.post(\"http://localhost:1337/api/upload\", formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      this.images = [];\n      resImages.data.forEach(el => this.images.push(el.id));\n      let jsonImages = [];\n      this.images.forEach(img => jsonImages.push({\n        id: img\n      }));\n      try {\n        const resListing = await axios.post(\"http://localhost:1337/api/listings\", {\n          data: {\n            title: this.title,\n            description: this.description,\n            email: this.email,\n            phone: this.phone,\n            price: this.price,\n            images: jsonImages\n          }\n        }, {\n          headers: {\n            Authorization: `Bearer ${useUserStore().jwt}`\n          }\n        });\n        alert(\"Annuncio inserito correttamente\");\n      } catch (err) {\n        alert(\"Errore nell'inserimento dell'annuncio\");\n      }\n      if (resListing) {} else {}\n    },\n    readAndPreview(file) {\n      // Make sure `file.name` matches our extensions criteria\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", () => {\n        this.imagesUrls.push(reader.result);\n      }, false);\n      reader.readAsDataURL(file);\n    },\n    setCat(e, cat) {\n      e.preventDefault();\n      this.category = cat;\n    }\n  }\n};","map":{"version":3,"names":["axios","useUserStore","useCategoriesStore","name","data","imageIndex","title","description","price","phone","email","imagesUrls","category","images","categoriesStore","Object","created","methods","nextImage","e","preventDefault","carouselItems","document","getElementsByClassName","length","prevImage","setImages","reader","FileReader","Array","from","target","files","filter","f","prototype","forEach","call","readAndPreview","submit","formData","FormData","img","append","resImages","post","headers","el","push","id","jsonImages","resListing","Authorization","jwt","alert","err","file","addEventListener","result","readAsDataURL","setCat","cat"],"sources":["/home/dario/Documenti/GitHub/demo-web-app-frontend/src/views/InsertListing.vue"],"sourcesContent":["<template>\n    <main>\n        <div class=\"container align-items-start\">\n            <div class=\"card\" style=\"width: 40rem;\">\n                <div class=\"card-body\">\n                    <form style=\"\">\n                        <div class=\"form-group mb-3\">\n                            <label for=\"formTitle\" class=\"form-label\">Titolo</label>\n                            <input v-model=\"title\" class=\"form-control\" type=\"text\" id=\"formTitle\" multiple>\n                        </div>\n\n                        <div v-if=\"this.images !== undefined && this.images.length > 0\" \n                        id=\"carouselExampleControls\" class=\"carousel slide\" data-ride=\"carousel\">\n                            <div v-for=\"(img, index) in this.imagesUrls\" class=\"carousel-inner\">\n                                <div class=\"carousel-item\" :class=\" index === this.imageIndex ? 'active' : ''\">\n                                    <img class=\"d-block card-img-top\" :src=\"img\">\n                                </div>\n                            </div>\n                            <a v-if=\"this.imagesUrls.length > 1\" class=\"carousel-control-prev\" @click=\"prevImage\" role=\"button\" data-slide=\"prev\">\n                                <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\n                                <span class=\"sr-only\">Previous</span>\n                            </a>\n                            <a v-if=\"this.imagesUrls.length > 1\" class=\"carousel-control-next\" @click=\"nextImage\" role=\"button\" data-slide=\"next\">\n                                <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\n                                <span class=\"sr-only\">Next</span>\n                            </a>\n                        </div>\n                        <div class=\"form-group mb-3\">\n                            <label for=\"formFileMultiple\" class=\"form-label\">Foto</label>\n                            <input class=\"form-control\" type=\"file\"  accept=\".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*\" \n                            id=\"formFileMultiple\" @change=\"setImages\" multiple>\n                        </div>\n\n                        <div class=\"form-group mb-3 dropdown\">\n                            <button class=\"btn btn-secondary dropdown-toggle\" type=\"button\" id=\"catDropdown\" data-bs-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                                {{ this.category === '' ? 'Seleziona Categoria' : this.category }}\n                            </button>\n                            <ul class=\"dropdown-menu\" aria-labelledby=\"catDropdown\">\n                                <li v-for=\"c in this.categoriesStore.categories\"><a class=\"dropdown-item\" @click=\"setCat($event, c.attributes.name)\">{{ c.attributes.name }}</a></li>\n                            </ul>\n                        </div>\n\n                        <div class=\"form-group\">\n                            <label class=\"form-label\" for=\"formDescription\">Descrizione</label> \n                            <textarea  class=\"form-control\" type=\"text\" id=\"formDescription\" rows=\"8\" v-model=\"description\" multiple></textarea>\n                        </div>\n                        <div class=\"form-group mb-3\">\n                            <label for=\"formPhone\" class=\"form-label\">Numero di Telefono</label>\n                            <input v-model=\"phone\" class=\"form-control\" type=\"text\" id=\"formPhone\" multiple>\n                        </div>\n                        <div class=\"form-group mb-3\">\n                            <label for=\"formEmail\" class=\"form-label\">Email</label>\n                            <input v-model=\"email\" class=\"form-control\" type=\"email\" id=\"formEmail\" multiple>\n                        </div>\n                        <div class=\"form-group mb-3\">\n                            <label for=\"formPrice\" class=\"form-label\">Prezzo</label>\n                            <input v-model=\"price\" class=\"form-control\" type=\"number\" id=\"formPrice\" min=\"0\" max=\"500000000\" multiple>\n                        </div>\n                        <div class=\"form-group\" style=\"padding-top: 1rem;\">\n                            <button type=\"submit\" class=\"btn btn-primary\"  @click=\"submit\">Inserisci</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n    </main>\n</template>\n\n<script>\n    import axios from 'axios';\n    import { useUserStore } from '@/stores/user';\n    import { useCategoriesStore } from '@/stores/categories';\n\n    export default{\n        name: \"Insert Listing\",\n        data(){\n            return{\n                imageIndex:0,\n            \n                title:'',\n                description:'',\n                price:0,\n                phone:'',\n                email:'',\n                imagesUrls:[],\n                category:'',\n                images:[],\n                categoriesStore: Object,\n            }\n        },\n        created(){\n            this.categoriesStore = useCategoriesStore();\n        },\n        methods: {\n            nextImage(e){\n                e.preventDefault();\n\n                const carouselItems = document.getElementsByClassName(\"carousel-item\");\n\n                this.imageIndex = (this.imageIndex + 1) % carouselItems.length;\n            },\n            prevImage(e){\n                e.preventDefault();\n\n                const carouselItems = document.getElementsByClassName(\"carousel-item\");\n\n                this.imageIndex = (this.imageIndex - 1) % carouselItems.length;\n                if(this.imageIndex  < 0)\n                    this.imageIndex = carouselItems.length - 1;\n            },\n            setImages(e){\n                e.preventDefault();\n\n                const reader = new FileReader();\n\n                let images = Array.from(e.target.files);\n\n                images = images.filter( f => f['type'] === 'image/jpeg' || f['type'] === 'image/png' )  //filters file that are not images\n\n                this.imagesUrls = []\n                \n                if (images) {\n                    Array.prototype.forEach.call(images, this.readAndPreview);\n                }\n                \n                this.images = images\n            },\n            async submit(e){\n                e.preventDefault();\n\n                const formData = new FormData();\n                \n                this.images.forEach(img => {\n                    formData.append(`files`, img)\n                })\n\n                const resImages = await axios.post(\"http://localhost:1337/api/upload\", formData, {\n                headers: { 'Content-Type': 'multipart/form-data' }})\n\n                this.images = []\n                resImages.data.forEach( (el) => this.images.push(el.id) )\n\n                let jsonImages = [];\n                this.images.forEach( (img) =>  jsonImages.push({ id:img }))\n\n                try{\n                    const resListing = await axios.post(\"http://localhost:1337/api/listings\", \n                    {data:{\n                        title: this.title,\n                        description: this.description,\n                        email: this.email,\n                        phone: this.phone,\n                        price: this.price,\n                        images: jsonImages,\n                    }},\n                    {headers:{               \n                        Authorization:\n                        `Bearer ${useUserStore().jwt}`\n                        }\n                    });\n\n                    alert(\"Annuncio inserito correttamente\")\n                }catch(err){\n                    alert(\"Errore nell'inserimento dell'annuncio\")\n                }\n                \n\n                if(resListing){\n                    \n                }else{\n                    \n                }\n            },\n            readAndPreview(file) {\n                // Make sure `file.name` matches our extensions criteria\n                const reader = new FileReader();\n\n                reader.addEventListener(\n                    \"load\",\n                    () => {\n                        this.imagesUrls.push(reader.result)\n                    },\n                    false,\n                );\n\n                reader.readAsDataURL(file);\n            },\n            setCat(e, cat){\n                e.preventDefault();\n\n                this.category = cat;\n            }\n        }\n    }\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}